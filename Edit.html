<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BINGO Edit</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .main-container{
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            position: relative;
            width: 1000px; /* 画像の幅 */
            height: 500px; /* 画像の高さ */
            margin: 0 20px;
        }

        .container img {
            display: block;
            width: 400px;
            height: 500px;
        }

        .square-textbox {
            position: absolute;
            width: 55px; /* 画像サイズに応じた幅 */
            height: 55px; /* 画像サイズに応じた高さ */
            resize: none;
            box-sizing: border-box;
            font-size: 36px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: hidden; /* 改行を防ぐ */
            white-space: nowrap; /* 改行を防ぐ */
            line-height: 1; /* 行の高さを調整して改行を防ぐ */
        }
        
        .arrow-button {
            font-size: 20px;
            background-color: rgb(200, 200, 200);
            border: 1px solid #000;
            cursor: pointer;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }
        #leftArrow {
            left: 0;

        }

        #rightArrow {
            left: 400px;

        }
        .input-form {
            position: absolute;

        margin-top: 20px; /* Adjust as needed */
        left: 600px;
        top:300px
        }

        .input-number {
            width: 200px; /* Adjust width as needed */
            padding: 5px;
            margin-bottom: 10px; /* Adjust spacing between inputs */
            font-size: 16px; /* Adjust font size */
    
        
        }

        .input-submit {
            padding: 8px 15px;
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 16px; /* Adjust font size */
        }

        .input-output {
            margin-top: 10px; /* Adjust margin as needed */
            font-size: 14px; /* Adjust font size */
        }

        /* テキストボックスの配置（画像のピクセル座標で指定） */

        
        .textbox-1 { top:  177.5px;  left: 77.5px; } /* 画像の高さの30.5% + 20px、幅の13.5% + 10px */
        .textbox-2 { top: 177.5px; left: calc(77.5px + 67.5px); } /* 画像の高さの30.5% + 20px、幅の25% + 10px */
        .textbox-3 { top:  177.5px; left: calc(77.5px + (67.5px * 2)); } /* 画像の高さの30.5% + 20px、幅の36.5% + 10px */
        .textbox-4 { top:  177.5px;  left: calc(77.5px + (67.5px * 3)); } /* 画像の高さの30.5% + 20px、幅の48% + 10px */
        .textbox-5 { top:  177.5px;  left: calc(77.5px + (67.5px * 4)); } /* 画像の高さの30.5% + 20px、幅の59.5% + 10px */

        .textbox-6 { top: 245.5px; left: 77.5px; } /* 画像の高さの42% + 20px、幅の13.5% + 10px */
        .textbox-7 { top: 245.5px;left: calc(77.5px + 67.5px); } /* 画像の高さの42% + 20px、幅の25% + 10px */
        .textbox-8 { top:245.5px; left: calc(77.5px + (67.5px * 2)); } /* 画像の高さの42% + 20px、幅の36.5% + 10px */
        .textbox-9 { top: 245.5px; left: calc(77.5px + (67.5px * 3)); } /* 画像の高さの42% + 20px、幅の48% + 10px */
        .textbox-10 { top: 245.5px; left: calc(77.5px + (67.5px * 4)); } /* 画像の高さの42% + 20px、幅の59.5% + 10px */
        .textbox-11 { top: 313.5px; left: 77.5px; } /* 画像の高さの53.5% + 20px、幅の13.5% + 10px */
        .textbox-12 { top: 313.5px; left: calc(77.5px + 67.5px); } /* 画像の高さの53.5% + 20px、幅の25% + 10px */
        .textbox-13 { top: 313.5px; left: calc(77.5px + (67.5px * 2)); display: none; } /* 中央のテキストボックスを非表示にする */
        .textbox-14 { top: 313.5px; left: calc(77.5px + (67.5px * 3)); } /* 画像の高さの53.5% + 20px、幅の48% + 10px */
        .textbox-15 { top: 313.5px; left: calc(77.5px + (67.5px * 4)); } /* 画像の高さの53.5% + 20px、幅の59.5% + 10px */

        .textbox-16 { top: 381.5px; left: 77.5px; } /* 画像の高さの65% + 20px、幅の13.5% + 10px */
        .textbox-17 { top: 381.5px; left: calc(77.5px + 67.5px); } /* 画像の高さの65% + 20px、幅の25% + 10px */
        .textbox-18 { top: 381.5px; left: calc(77.5px + (67.5px * 2)); } /* 画像の高さの65% + 20px、幅の36.5% + 10px */
        .textbox-19 { top: 381.5px; left: calc(77.5px + (67.5px * 3)); } /* 画像の高さの65% + 20px、幅の48% + 10px */
        .textbox-20 { top: 381.5px; left: calc(77.5px + (67.5px * 4)); } /* 画像の高さの65% + 20px、幅の59.5% + 10px */

        .textbox-21 { top: 445.5px; left: 77.5px; } /* 画像の高さの76.5% + 20px、幅の13.5% + 10px */
        .textbox-22 { top:445.5px; left: calc(77.5px + 67.5px); } /* 画像の高さの76.5% + 20px、幅の25% + 10px */
        .textbox-23 { top: 445.5px; left: calc(77.5px + (67.5px * 2)); } /* 画像の高さの76.5% + 20px、幅の36.5% + 10px */
        .textbox-24 { top: 445.5px; left: calc(77.5px + (67.5px * 3)); } /* 画像の高さの76.5% + 20px、幅の48% + 10px */
        .textbox-25 { top: 445.5px; left: calc(77.5px + (67.5px * 4)); } /* 画像の高さの76.5% + 20px、幅の59.5% + 10px */
        .form-container{
            margin: 0 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
    </style>
</head>
<body class="input">
    <main>
        <div class="main-container">
            <div class="form-container">
                <button class="back-button" onclick="location.href='./Title.html'">タイトルに戻る</button>
                <button class="home-button" onclick="location.href='./Home.html'">ホームに戻る</button>
                <button class="card-button" onclick="location.href='./Select.html'">カード選択に戻る</button>
            </div>
            <div class="container">
                <button class="arrow-button" id="leftArrow" onclick="moveLeft()">←</button>
                <img src="picture/BINGOcard.JPG" alt="BINGO Card">
                <input class="square-textbox textbox-1" type="number" id="numeric"></input>
                <input class="square-textbox textbox-2" type="number" id="numeric"></input>
                <input class="square-textbox textbox-3" type="number" id="numeric"></input>
                <input class="square-textbox textbox-4" type="number" id="numeric"></input>
                <input class="square-textbox textbox-5" type="number" id="numeric"></input>
                <input class="square-textbox textbox-6" type="number" id="numeric"></input>
                <input class="square-textbox textbox-7" type="number" id="numeric"></input>
                <input class="square-textbox textbox-8" type="number" id="numeric"></input>
                <input class="square-textbox textbox-9" type="number" id="numeric"></input>
                <input class="square-textbox textbox-10" type="number" id="numeric"></input>
                <input class="square-textbox textbox-11" type="number" id="numeric"></input>
                <input class="square-textbox textbox-12" type="number" id="numeric"></input>
                <input class="square-textbox textbox-13" type="number" id="numeric"></input>
                <input class="square-textbox textbox-14" type="number" id="numeric"></input>
                <input class="square-textbox textbox-15" type="number" id="numeric"></input>
                <input class="square-textbox textbox-16" type="number" id="numeric"></input>
                <input class="square-textbox textbox-17" type="number" id="numeric"></input>
                <input class="square-textbox textbox-18" type="number" id="numeric"></input>
                <input class="square-textbox textbox-19" type="number" id="numeric"></input>
                <input class="square-textbox textbox-20" type="number" id="numeric"></input>
                <input class="square-textbox textbox-21" type="number" id="numeric"></input>
                <input class="square-textbox textbox-22" type="number" id="numeric"></input>
                <input class="square-textbox textbox-23" type="number" id="numeric"></input>
                <input class="square-textbox textbox-24" type="number" id="numeric"></input>
                <input class="square-textbox textbox-25" type="number" id="numeric"></input>
                <button id="rightArrow" class="arrow-button" onclick="moveRight()">→</button>
                <form class="input-form" onsubmit="return handleFormSubmit(event)">
                    <button class="register-button" id="registerButton">更新</button> <!-- 更新ボタンに変更 -->
                </form>
                
            </div>
        </div>
        
    </main>
    <button class="back-button" onclick="location.href='./Title.html'">タイトルに戻る</button>
    <button class="home-button" onclick="location.href='./Home.html'">ホームに戻る</button>

    <script>
   
        document.querySelectorAll('.square-textbox').forEach((textbox, index, textboxes) => {
            textbox.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (textboxes[index].value.length > 2) {
                        textboxes[index].value = textboxes[index].value.slice(0, 2);
                    }
                    let nextTextbox = textboxes[index + 1];
                    if (index === 11) {
                        nextTextbox = textboxes[index + 2];
                    }
                    if (nextTextbox) {
                        nextTextbox.focus();
                    }
                }
            });
        });
    </script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore-compat.js"></script>    
    <script>
        firebase.initializeApp({
            apiKey: "AIzaSyBFglLx2pDfHSpyEUUpn0c939BWS1vmzQg",
            projectId: "bingoapp-8c5c0",
        });

        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', function() {
            // クラウドストレージから選択したビンゴカードのIDとデータを取得
            const docId = localStorage.getItem('selectedBingoCardId');
            const data = JSON.parse(localStorage.getItem('selectedBingoCardData'));

            // データが存在する場合、テキストボックスに表示
            if (docId && data) {
                const textboxes = document.querySelectorAll('.square-textbox');
                alert(textboxes);
                console.log(textboxes); // コンソールにログ出力
                textboxes.forEach((textbox, index) => {
                    // data.values1 ではなく、data.values を参照する
                    textbox.value = data.values1 || ''; // データが存在すれば代入、なければ空文字をセット
                });
            }
            else {
                console.log('No document ID or data found in localStorage.');
            }
            
            // 更新ボタンのクリックイベントリスナーを設定
            document.querySelector('#registerButton').addEventListener('click', function() {
                const textboxes = document.querySelectorAll('.square-textbox');
                let values = [];
                textboxes.forEach(textbox => {
                    values.push(textbox.value);
                });

                // Save to Firestore
                db.collection('BINGOApp').doc(docId).update({
                    values1: values,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(function() {
                    console.log('Document updated successfully.');
                    alert(docId+'の更新が完了しました。');
                })
                .catch(function(error) {
                    console.error('Error updating document:', error);
                    alert('更新に失敗しました: ' + error.message);
                });
            });
        });
    </script>
</body>
</html>
